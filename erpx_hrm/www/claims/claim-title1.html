{% extends "www/master.html" %}

{% block title %}Claims{% endblock %}
{% block styles %}
<style type="text/css">
  @media only screen and (max-width: 360px){
      .border-request{
        margin-left: 0px !important;
      }

      .btn-approve{
        margin-right: 0px !important;
      }
      
    }
</style>
{% endblock %}

{% block nav %}
{% if user == 'Guest' %}
<li class=""><a href="/signin" aria-current="page">Sign in</a></li>
{% endif %}
{% if user != 'Guest' %}
{% include "www/nav.html" %}
{% endif %}
{% endblock %}

{% block sidenav %}
<!--sidenav-->
{% include "www/claims/sidenav.html" %}   
{% endblock %}
{% block footer %}
{% include "www/footer.html" %}
{% endblock %}
{% block main %}
{% if frappe.request.url.split("?")[1] %}
{% set expense_voucher = frappe.request.url.split("?")[1].split("=")[1] %}
{% set expense_claim = frappe.get_all("Expense Claim",filters={'name':expense_voucher},fields=['approval_status','status','total_claimed_amount','employee_name','expense_approver','reimbursement_type']) %}
{% set claim_details = frappe.get_all("Expense Claim Detail",filters={'parent': expense_voucher},fields=["expense_type","expense_date","merchant","amount","description","attach_document"])%}
{% endif %}
<div id="main">
 <div class="row">
  <div class="container">
    <div class="section-data-tables nav-wrapper black-text banner-title3">
      <!--<div class="content-wrapper-before"></div>-->
      <div class="col s12">
        <div class="breadcrumb">
          <a class="breadcrumb">Claims</a>
          <a href="/claims/index" class="breadcrumb">All Claims</a>
          <a href="/claims/claim-title1.html/?expense_claim={{expense_voucher}}" class="breadcrumb active">{{expense_voucher}}</a>
        </div>
      
      </div>
      <div class="col xl20 l20 m18 s12">
        <div id="card-stats" class="card" style="border-radius: 10px!important;">
          <div class="card-content">        
            <div class="row">
              <div style="height: 30px;"></div>
              <div class="row margin infodetails">
               <div class=" border-request requester">
                {% for exp in expense_claim %}
                <a href="#">Requester : {{exp.employee_name}}</a>
                <img style="float: right; margin-left: 10px;" width="25" height="25" src="/images/avatar.svg">
                {% endfor %}
              </div>

              <div style="margin-left: 35px; float: left;" class="border-request">
              {% for exp in expense_claim %}
               <a href="#">Approver : {{exp.expense_approver}}</a>
               <img style="float: right; margin-left: 10px;" width="25" height="25" src="/images/avatar.svg">
              {% endfor %}
             </div>

             <div class="pend-apprv right">
              {% for ap in expense_claim %}
              {% if ap.status == 'Draft' %}
              <p style="border-radius: 20px;text-align: center;width: 100%;background-color: #b2a30f;color: white;font-size: 10px;">
                  {{ap.status}}
              </p>
              {% elif ap.status == 'Unpaid' %}
              <p style="border-radius: 20px;text-align: center;width: 100%;background-color:  #b2a30f;color: white;font-size: 10px;">
                  {{ap.status}}
                </p>
              
              
              
              {% elif ap.status == 'Paid' %}
              <p style="border-radius: 20px;text-align: center;width: 100%;background-color: #0c811b;color: white;font-size: 10px;">
                  {{ap.status}}
                </p>
              
              
              {% elif ap.status == 'Rejected'%}
              <p style="border-radius: 20px;text-align: center;width: 100%;background-color: #ff0000;color: white;font-size: 10px;">
                  {{ap.status}}
                </p>
              
              
              {%- endif %}
              
              
              {% endfor %}
              <p style="font-size: 19px;text-align: right;">
                
                {% for ap in expense_claim %}
                {{currency}} {{'%0.2f'| format(ap.total_claimed_amount|float)}}
                {% endfor %}</p>
              <span style="font-size: 12px;text-align: right;">Total claim amount</span>
            </div>

          </div>
          <!-- <br>
          <hr>
          <br> -->
          <!-- <div class="row margin infodetails">
            <div class="option-date-appr input-field col s12 m4 l4 xl3">
              <p style="margin-bottom: 10px;float: left;">Start Date</p>
              <img src="/icons/calendar-blue.png" width="20" height="20" style="bottom: 23px; position: absolute; margin-top: 12px; right: 35px;" ><input style="border: 1px solid #c1c1c1; border-radius: 5px;" name="start_date" class="textbox-n" type="date" onfocus="(this.type='date')" id="from_date">
            </div>
            <div class="option-date-appr input-field col s12 m4 l4 xl3">
              <p style="margin-bottom: 10px;float: left
              ">End Date</p>
              <img src="/icons/calendar-blue.png" width="20" height="20" style="bottom: 23px; position: absolute; margin-top: 12px; right: 35px;" ><input style="border: 1px solid #c1c1c1; border-radius: 5px;" name="end_date" class="textbox-n" type="date" onfocus="(this.type='date')" id="to_date">
            </div>
          </div> -->
        </div>
      </div>
    </div>


  </div>
  <div class="col xl20 l20 m18 s12">
    <div id="card-stats" class="card" style="border-radius: 10px!important;">
      <div class="card-content">  
        <img style="display: inline;float: left;" width="22" height="22" class="sidenav-icon" src="/icons/claims.png">
        {% for claim in expense_claim %}
        {% if claim.reimbursement_type == "Submission via Payroll" %}
        <div class="card-title" style="margin-top: -5px;;text-align: left;margin-left: 35px;">Reimbursement via payroll</div>
        {% elif claim.reimbursement_type == "Direct Payment" %}
        <div class="card-title" style="margin-top: -5px;;text-align: left;margin-left: 35px;">Reimbursement via Direct Pay</div>
        {% endif %}
        {% endfor %}
        <br>
        
        
        <table style="font-size: 14px;">
          <thead>
         <tr style="font-size: 16px; background-color: #f9f9f9; width: 100%!important;" >
          <th style="border-right:none!important;">Date</th>
          <th style="border-right:none!important;">Claim Type</th>
          <th style="border-right:none!important;">Merchant</th>
          <th style="border-right:none!important;">Description</th>
          <th style="border-right:none!important;">Amount</th>
          <th style="border-right:none!important;"></th>
        </tr>
        </thead>
        <tbody>
        {% for claim in claim_details %}
        <tr>
          <td>{{claim.expense_date.strftime("%d-%m-%Y")}}</td>
          <td>{{claim.expense_type}}</td>
          <td>{{claim.merchant}}</td>
          <td>{{claim.description}}</td>
          <td>{{currency}} {{'%0.2f'| format(claim.amount|float)}}</td>
          {% if claim.attach_document %}
          <td style="text-align: center;"><a href="{{site_url}}{{claim.attach_document}}"><i class="material-icons-outlined">attach_file</i></a></td>
          {%else%}
          <td style="text-align: center;">No Attachment</td>
          {% endif %}
        </tr>
        {% endfor %}
        
        <!-- <tr>
          <td>26 Jul 2019</td>
          <td>Medical</td>
          <td>Thomson Hospital</td>
          <td>Thomson Hospital</td>
          <td>MYR 2,500.00</td>
          <td style="text-align: center;"><i class="material-icons-outlined">attach_file</i></td>

        </tr> -->
      </tbody>
      
        <tr>
          <th colspan="4">Total Claim Amount</th>
          <!-- <th></th>
          <th></th>
          <th></th> -->
          <th colspan="2">{% for ap in expense_claim %}
            {{currency}} {{'%0.2f'| format(ap.total_claimed_amount|float)}}
            {% endfor %}</th>
          <!-- <th></th> -->
        </tr>
        
      

      </table> 
      

      <!-- <div style="height: 90px;"></div> -->
      <!-- <img style="display: inline;float: left;" width="22" height="22" class="sidenav-icon" src="/icons/claims.png"> -->
      <!-- <div class="card-title" style="margin-top: -5px;text-align: left;margin-left: 35px;">Reimbursement via direct payment
      </div> -->
      <!-- <br> -->
      <!-- <table style="font-size: 14px;">
       <tr style="font-size: 16px; background-color: #f9f9f9; width: 100%!important;" >
        <th style="border-right:none!important;">Date</th>
        <th style="border-right:none!important;">Claim Type</th>
        <th style="border-right:none!important;">Merchant</th>
        <th style="border-right:none!important;">Description</th>
        <th style="border-right:none!important;">Amount</th>
        <th style="border-right:none!important;"></th>
      </tr>

      <tr>
        <td style="text-align: center;" colspan="6">No claim item</td>
      </tr>

      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>Total MYR0.00</td>
        <td></td>
      </tr>
    </table> -->


    <!-- <div style="height: 90px;"></div>
    <img style="display: inline;float: left;" width="22" height="22" class="sidenav-icon" src="/icons/claims.png">
    <div class="card-title" style="margin-top: -5px;text-align: left;margin-left: 35px;">Report History</div>
    <br>
    <table style="font-size: 14px;">
     <tr style="font-size: 16px; background-color: #f9f9f9; width: 100%!important;" >
      <th style="border-right:none!important;">Date</th>
      <th style="border-right:none!important;">Claim Type</th>
      <th style="border-right:none!important;">Merchant</th>
      <th style="border-right:none!important;">Description</th>
      <th style="border-right:none!important;">Amount</th>
      <th style="border-right:none!important;"></th>
    </tr>

    <tr>
      <td style="text-align: center;" colspan="6">No History</td>
    </tr>

  </table> -->
</div>
{% for ap in expense_claim %}
{% if ap.approval_status == "Draft" %}
<div class="row margin infodetails" style="display: block;">
  <a href="#" style=" background-color: #00aeef;  border-radius: 25px;  width: 100px;  text-align: center;  color: white;  line-height: 50px;line-height: 40px;margin-right: 28px;margin-bottom: 13px; " 
  class="modal-trigger waves-effect waves-light right btn-approve" id="approve">Approve</a>
  <a href="#" style=" background-color: white; border: 1px #00aeef solid; border-radius: 25px;  width: 100px;  text-align: center;  color:#00aeef;  line-height: 50px;line-height: 40px;margin-right: 28px;margin-bottom: 13px; " 
  class="modal-trigger waves-effect waves-dark right" id="decline">Decline</a></div>
</div>

{% elif ap.status == "Unpaid" and ap.reimbursement_type == "Direct Payment" %}
<a href="#" style=" background-color: #00aeef;  border-radius: 25px;  width: 300px;  text-align: center;  color: white;  line-height: 50px;line-height: 40px;margin-right: 28px;margin-bottom: 13px; " 
  class="modal-trigger waves-effect waves-light right btn-approve" id="d_reimburse">Reimburse Via Direct Payment</a>
{% endif %}
{% endfor %}

</div>
</div>
</div>
</div>
</div>
{% endblock %}

{% block scripts %}

<script defer src="/claims/js/claim-title1.js" type="text/javascript"></script>
<script>
  frappe.csrf_token = "{{ csrf_token }}";
</script>
<script type="text/javascript">
  var all_claim = document.getElementById("all-claim");
  all_claim.classList.add("active");
</script>
{% endblock %}