{% extends "www/master.html" %}

{% block title %}Claims{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/materialize-stepper@2.1.4/materialize-stepper.css" rel="stylesheet">
  
  
  <!-- Materializecss compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
  <!-- jQueryValidation Plugin -->
  <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js"></script>
{% endblock %}

{% block nav %}
{% if user == 'Guest' %}
<li class=""><a href="/signin" aria-current="page">Sign in</a></li>
{% endif %}
{% if user != 'Guest' %}
{% include "www/nav.html" %}
{% endif %}
{% endblock %}

{% block sidenav %}
<!--sidenav-->
{% include "www/claims/sidenav.html" %}
{% endblock %}

{% block main %}


  
  <style type="text/css">
    .waves-ripple{
      background-color: rgba(0,0,0,0) !important;
    }
    
    tbody{
      border: none !important;
    }

    [type="checkbox"].filled-in:checked + span:not(.lever):before{
      border-right: 2px solid green !important;
      border-bottom: 2px solid green !important;
    }
    [type="checkbox"].filled-in + span:not(.lever):after {
      border-radius: 6px !important;
    }

    [type="checkbox"].filled-in:checked + span:not(.lever):after{
      border: 2px solid #e1e1e1 !important;
      background-color: white !important;
    }

    [type="checkbox"].filled-in:not(:checked) + span:not(.lever):after{
      border: 2px solid #e1e1e1 !important;
      background-color: white !important;
    }
  </style>
  


<div id="main">
 <div class="row">
  <div class="container">
    <div class="section-data-tables nav-wrapper black-text banner-title3">
      <!--<div class="content-wrapper-before"></div>-->
      <div class="col s12">
        <div class="breadcrumb">
         <a class="breadcrumb">Claims</a>
         <a class="breadcrumb">Reimbursement</a>
         <a class="breadcrumb">Submit to Payroll</a>
         <a href="/claims/new-submission.html" class="breadcrumb active">New Submission</a>
       </div>
     </div>
     <div class="col xl20 l20 m18 s12">
      <div id="card-stats" class="card">
        <div class="card-content">
          <img style="display: inline;float: left;" width="22" height="22" class="sidenav-icon" src="/icons/reimbursement.png">
          <h4 class="card-title directorytitle" style="text-align: left;">Submissions</h4>

          <br><br>
          <div class="row">
            <div style="height: 40px;"></div>
            <div class="row margin infodetails">
             <form>
    <ul class="stepper parallel horizontal">
      <li class="step active">
        <div class="step-title waves-effect waves-dark">Step 1</div>
        <div class="step-content">
          <div class="row">
            <div class='form-field col s12'>
              <h4 class="card-title" style="text-align: left;">1. Select a Payroll</h4> 
              <span style="float: left; font-size: 14px; color: #6c6868">Please choose a period and a type of the payroll you wish to attach claim reports to.</span>
              <br><br>

              <div class="row margin infodetails">
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Submit to Payroll for</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Period</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Select Period</option>
                    <option value="July">July 2019</option>
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Select Payroll Type</option>
                    <option value="month">Month End Pay</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="step-actions">
            <button class="waves-effect waves-dark btn next-step" data-validator="validateStepOne">CONTINUE</button>
            
          </div>
        </div>
      </li>
      <li class="step">
        <div class="step-title waves-effect waves-dark">Step 2</div>
        <div class="step-content">
          <div class="row">
            <div class='form-field col s12' style="padding-bottom: 15px;">
              
                <h4 class="card-title" style="text-align: left;">1. Select a Payroll</h4> 
                <span style="float: left; font-size: 14px; color: #6c6868">Please choose a period and a type of the payroll you wish to attach claim reports to.</span>
                <br><br>
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Submit to Payroll for</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Period</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>July 2019</option>
                    
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Month End Pay</option>
                    
                  </select>
                </div>
                
                
            </div>
            
            <div class='form-field col s12'>
                <h4 class="card-title" style="text-align: left;">2. Select Claim Report</h4>
                <span style="float: left; font-size: 14px; color: #6c6868">This is the list of claim reports that are ready to be submitted to the selected payroll.</span>
                <br>
                <table style="font-size: 14px;margin-top: 24px; border-collapse: collapse; ">
                  <tr style="border: 1px solid #cfd8dc !important;font-size: 14px;background-color: #f9f9f9; width: 100%!important;" >
                    <th style=" border-right:none!important;">
                      <p>
                        <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                    </th>
                    <th style=" border-right:none!important;">Title</th>
                    <th style=" border-right:none!important;">Requestor</th>
                    <th style=" border-right:none!important;">Cutoff Date</th>
                    <th style=" border-right:none!important;">Payroll</th>
                  </tr>
                  <tr style="border: 1px solid #cfd8dc !important;">
                    <td>
                      <p>
                         <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                      </p>
                    </td>
                    <td>26072019 - AA</td>
                    <td><p style="color: white;padding: 10px;height: 40px;width: 40px;background-color: #bbb;border-radius: 50%;display: inline-block;text-align: center;">A</p></td>
                    <td>26 Jul 2019</td>
                    <td>MYR 1,200.00</td>
                  </tr>
                </table>
            </div>
          <div class="step-actions" style="top: 460px;">
            <button class="waves-effect waves-dark btn next-step">CONTINUE</button>
            
          </div>
        </div>
      </li>
      <li class="step">
        <div class="step-title waves-effect waves-dark">Step 3</div>
        <div class="step-content">
          <div class="row">
            <div class='form-field col s12' style="padding-bottom: 15px;">
              
                <h4 class="card-title" style="text-align: left;">1. Select a Payroll</h4> 
                <span style="float: left; font-size: 14px; color: #6c6868">Please choose a period and a type of the payroll you wish to attach claim reports to.</span>
                <br><br>
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Submit to Payroll for</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Period</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>July 2019</option>
                    
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Month End Pay</option>
                    
                  </select>
                </div>
                
                
            </div>
            
            <div class='form-field col s12' style="padding-bottom: 30px;">
                <h4 class="card-title" style="text-align: left;">2. Select Claim Report</h4>
                <span style="float: left; font-size: 14px; color: #6c6868">This is the list of claim reports that are ready to be submitted to the selected payroll.</span>
                <br>
                <table style="font-size: 14px;margin-top: 24px; border-collapse: collapse; ">
                  <tr style="border: 1px solid #cfd8dc !important;font-size: 14px;background-color: #f9f9f9; width: 100%!important;" >
                    <th style=" border-right:none!important;">
                      <p>
                        <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" disabled="disabled" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                    </th>
                    <th style=" border-right:none!important;">Title</th>
                    <th style=" border-right:none!important;">Requestor</th>
                    <th style=" border-right:none!important;">Cutoff Date</th>
                    <th style=" border-right:none!important;">Payroll</th>
                  </tr>
                  <tr style="border: 1px solid #cfd8dc !important;">
                    <td>
                      <p>
                         <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" disabled="disabled" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                      </p>
                    </td>
                    <td>26072019 - AA</td>
                    <td><p style="color: white;padding: 10px;height: 40px;width: 40px;background-color: #bbb;border-radius: 50%;display: inline-block;text-align: center;">A</p></td>
                    <td>26 Jul 2019</td>
                    <td>MYR 1,200.00</td>
                  </tr>
                </table>
            </div>

            <div class='form-field col s12' style="padding-bottom: 15px;">
              
                <h4 class="card-title" style="text-align: left;">3. Connect Claim Types with Payroll Items</h4> 
                <span style="float: left; font-size: 14px; color: #6c6868">This is the list of the claim types reimbursement method as payroll in the selected claim reports. To submit claim reports to payroll, you need to connect claim types with payroll items.</span>
                <br><br>
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Claim Types</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Claim Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Travel</option>
                    
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Item</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Petrol/Travel Allowance</option>
                    
                  </select>
                </div>
                <span style="float: left; font-size: 14px; color: #6c6868"><i>*Note : Payroll items are additional items of Payroll. To see the additional items, go to the Payroll items page in Payroll.</i></span>
                
                
            </div>
          </div>

          
          <div class="step-actions" style="top: 740px;">
            <button class="waves-effect waves-dark btn next-step">Continue</button>
            
          </div>
        </div>
      </li>
      <li class="step">
        <div class="step-title waves-effect waves-dark">Step 4</div>
        <div class="step-content">
          <div class="row">
            <div class='form-field col s12' style="padding-bottom: 15px;">
              
                <h4 class="card-title" style="text-align: left;">1. Select a Payroll</h4> 
                <span style="float: left; font-size: 14px; color: #6c6868">Please choose a period and a type of the payroll you wish to attach claim reports to.</span>
                <br><br>
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Submit to Payroll for</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Period</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>July 2019</option>
                    
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Month End Pay</option>
                    
                  </select>
                </div>
                
                
            </div>
            
            <div class='form-field col s12' style="padding-bottom: 30px;">
                <h4 class="card-title" style="text-align: left;">2. Select Claim Report</h4>
                <span style="float: left; font-size: 14px; color: #6c6868">This is the list of claim reports that are ready to be submitted to the selected payroll.</span>
                <br>
                <table style="font-size: 14px;margin-top: 24px; border-collapse: collapse; ">
                  <tr style="border: 1px solid #cfd8dc !important;font-size: 14px;background-color: #f9f9f9; width: 100%!important;" >
                    <th style=" border-right:none!important;">
                      <p>
                        <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" disabled="disabled" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                    </th>
                    <th style=" border-right:none!important;">Title</th>
                    <th style=" border-right:none!important;">Requestor</th>
                    <th style=" border-right:none!important;">Cutoff Date</th>
                    <th style=" border-right:none!important;">Payroll</th>
                  </tr>
                  <tr style="border: 1px solid #cfd8dc !important;">
                    <td>
                      <p>
                         <label class="container">
                          <input type="checkbox" class="filled-in" checked="checked" disabled="disabled" /> 
                          <span class="checkmark" style="vertical-align: -50%;"></span>
                        </label>
                      </p>
                      </p>
                    </td>
                    <td>26072019 - AA</td>
                    <td><p style="color: white;padding: 10px;height: 40px;width: 40px;background-color: #bbb;border-radius: 50%;display: inline-block;text-align: center;">A</p></td>
                    <td>26 Jul 2019</td>
                    <td>MYR 1,200.00</td>
                  </tr>
                </table>
            </div>

            <div class='form-field col s12' style="padding-bottom: 30px;">
              
                <h4 class="card-title" style="text-align: left;">3. Connect Claim Types with Payroll Items</h4> 
                <span style="float: left; font-size: 14px; color: #6c6868">This is the list of the claim types reimbursement method as payroll in the selected claim reports. To submit claim reports to payroll, you need to connect claim types with payroll items.</span>
                <br><br>
                <div style="margin-top: 61px;text-align: left;padding-left: 0px;" class="input-field col s12 m2">Claim Types</div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Claim Type</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Travel</option>
                    
                  </select>
                </div>
                <div class="input-field col s12 m3">
                  <p style="text-align: left;margin-bottom: 10px;">Payroll Item</p>
                  <select style="padding-left: 10px;width: -webkit-fill-available;">
                    <option value="" disabled selected>Petrol/Travel Allowance</option>
                    
                  </select>
                </div>
                <span style="float: left; font-size: 14px; color: #6c6868"><i>*Note : Payroll items are additional items of Payroll. To see the additional items, go to the Payroll items page in Payroll.</i></span>
            </div>

            <div class='form-field col s12' style="padding-bottom: 30px;">
                <h4 class="card-title" style="text-align: left;">4. One Last Check Before Submission</h4>
                <span style="float: left; font-size: 14px; color: #6c6868">Please review the details of the submission. You can complete this process by clicking "Complete Submitting" button.</span>
                <br>
                <table style="font-size: 14px;margin-top: 24px; border-collapse: collapse; ">
                  <tr style="border: 1px solid #cfd8dc !important;font-size: 14px;background-color: #f9f9f9; width: 100%!important;" >
                    
                    <th style=" border-right:none!important;">Title</th>
                    <th style=" border-right:none!important;">Requestor</th>
                    <th style=" border-right:none!important;">Cutoff Date</th>
                    <th style=" border-right:none!important;">Payroll</th>
                  </tr>
                  <tr style="border: 1px solid #cfd8dc !important">
                    <td>26072019 - AA</td>
                    <td><p style="color: white;padding: 10px;height: 40px;width: 40px;background-color: #bbb;border-radius: 50%;display: inline-block;text-align: center;">A</p></td>
                    <td>26 Jul 2019</td>
                    <td>MYR 1,200.00</td>
                  </tr>
                  <tr style="border: none !important">
                    <td colspan="2"></td>
                    
                    <td style=" text-align: right !important;"><b>Total Payroll Amount</b></td>
                    <td ><b>MYR 1,200.00</b></td>
                  </tr>
                </table>
            </div>
          </div>
          <div class="step-actions" style="top: 1037px;">
            <input type="submit" class="waves-effect waves-dark btn next-step" value="Complete Submitting"/>
            
          </div>
        </div>
      </li>

      <li class="step finish">
        <div class="step-title waves-effect waves-dark">Done</div>
        <div class="step-content" style="padding-top: 100px;">
          <div class="row">
            <div class='form-field col s12' >
             <p style="text-align: center;color: #EC008C; font-size: 30px;font-weight: 600">Congratulations!</p>
             <p style="text-align: center;font-size: 28px;">You have successfully submitted reports to the payroll. </p>
             <p style="text-align: center;padding-bottom: 30px;">To review submitted claim reports, please go to <a href="/claims/submission-his.html" style="color: #00aeef">Submission History</a> page.</p>
             <a href="/claims/submission-his.html" class="waves-effect waves-dark btn">Go to Submission History</a>
            </div>
          </div>
          
        </div>
      </li>
    </ul>
  </form>
             


          </div>

        </div>
      </div>
    </div>
  </div>

  
</div>
</div>
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function() {
  $('.stepper').activateStepper();
})

function validateStepOne() {
  // Extract the checked checkboxes from the first step
  //if($('.step').first().find('input[type="checkbox"]:checked').length)
    return true;
  //return false;
}

function validateStepThree() {
  var validation = true;
  //if($('.step:nth-child(3) input[type="text"]').val().indexOf('materialize') === -1)
  //  validation = false;
  //if($('.step:nth-child(3) input[type="checkbox"]:checked').length === 0)
  //  validation = false;
  return validation;
  
}

function nextStepThreeHandler() {
  if(validateStepThree())
    $('.stepper').nextStep();
  else {
    $('.stepper ').destroyFeedback();              $('.stepper').getStep($('.stepper').getActiveStep()).addClass('wrong');
  }
}




/* Materializecss Stepper - By Kinark 2016
// https://github.com/Kinark/Materialize-stepper
// JS v2.1.3
*/

var validation = $.isFunction($.fn.valid) ? 1 : 0;

$.fn.isValid  = function() {
   if(validation){
      return this.valid();
   } else {
      return true;
   }
};

if (validation) {
   $.validator.setDefaults({
      errorClass: 'invalid',
      validClass: "valid",
      errorPlacement: function (error, element) {
         if(element.is(':radio') || element.is(':checkbox')) {
            error.insertBefore($(element).parent());
         } else {
            error.insertAfter(element); // default error placement.
            // element.closest('label').data('error', error);
            // element.next().attr('data-error', error);
         }
      },
      success: function (element) {
         if(!$(element).closest('li').find('label.invalid:not(:empty)').length){
            $(element).closest('li').removeClass('wrong');
         }
      }
   });

   // When parallel stepper is defined we need to consider invisible and
   // hidden fields
   if($('.stepper.parallel').length) $.validator.setDefaults({ignore:''});
}

$.fn.getActiveStep  = function() {
   var active = this.find('.step.active');
   return $(this.children('.step:visible')).index($(active))+1;
};

$.fn.activateStep  = function(callback) {
   if($(this).hasClass('step')) return;
   var stepper = $(this).closest('ul.stepper');
   stepper.find('>li').removeAttr("data-last");
   if(window.innerWidth < 993 || !stepper.hasClass('horizontal')) {
      $(this).addClass("step").stop().slideDown(400, function(){
         $(this).css({'height':'auto', 'margin-bottom': '','display': 'inherit'});if(callback)callback();
         stepper.find('>li.step').last().attr('data-last', 'true');
      });
   } else {
      $(this).addClass("step").stop().css({'width':'0%','display': 'inherit'}).animate({width:'100%'}, 400, function(){
         $(this).css({'height':'auto', 'margin-bottom': '','display': 'inherit'});if(callback)callback();
         stepper.find('>li.step').last().attr('data-last', 'true');
      });
   }
};

$.fn.deactivateStep  = function(callback) {
   if(!$(this).hasClass('step')) return;
   var stepper = $(this).closest('ul.stepper');
   stepper.find('>li').removeAttr("data-last");
   if(window.innerWidth < 993 || !stepper.hasClass('horizontal')) {
      $(this).stop().css({'transition':'none', '-webkit-transition':'margin-bottom none'}).slideUp(400, function(){
         $(this).removeClass("step").css({'height':'auto','margin-bottom':'','transition':'margin-bottom .4s','-webkit-transition':'margin-bottom .4s'});
         if(callback)callback();
         stepper.find('>li').removeAttr("data-last");
         stepper.find('>li.step').last().attr('data-last', 'true');
      });
   } else {
      $(this).stop().animate({width:'0%'}, 400, function(){
         $(this).removeClass("step").hide().css({'height':'auto', 'margin-bottom': '','display': 'none', 'width': ''});
         if(callback)callback();
         stepper.find('>li.step').last().attr('data-last', 'true');
      });
   }
};

$.fn.showError  = function(error) {
   if(validation) {
      var name = this.attr('name');
      var form = this.closest('form');
      var obj = {};
      obj[name] = error;
      form.validate().showErrors(obj);
      this.closest('li').addClass('wrong');
   } else {
      this.removeClass('valid').addClass('invalid');
      this.next().attr('data-error', error);
   }
};

$.fn.activateFeedback  = function() {
   var active = this.find('.step.active:not(.feedbacking)').addClass('feedbacking').find('.step-content');
   active.prepend('<div class="wait-feedback"> <div class="preloader-wrapper active"> <div class="spinner-layer spinner-blue"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-red"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-yellow"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-green"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div></div></div>');
};

$.fn.destroyFeedback  = function() {
   var active = this.find('.step.active.feedbacking');
   if(active) {
      active.removeClass('feedbacking');
      active.find('.wait-feedback').remove();
   }
   return true;
};

$.fn.resetStepper  = function(step) {
   if(!step) step = 1;
   var form = $(this).closest('form');
   $(form)[0].reset();
   Materialize.updateTextFields();
   return $(this).openStep(step);
};

$.fn.submitStepper  = function(step) {
   var form = this.closest('form');
   if(form.isValid()) {
      form.submit();
   }
};

$.fn.nextStep = function(callback, activefb, e) {
    
    
   var stepper = this;
   var settings = $(stepper).data('settings');
   var form = this.closest('form');
   var active = this.find('.step.active');
   
   var next = $(this.children('.step:visible')).index($(active))+2;

   var feedback = active.find('.next-step').length > 1 ? (e ? $(e.target).data("feedback") : undefined) : active.find('.next-step').data("feedback");
   // If the stepper is parallel, we want to validate the input of the current active step. Not all elements.
   if((settings.parallel && $(active).validateStep()) || (!settings.parallel && form.isValid())) {
      if(feedback && activefb) {
         if(settings.showFeedbackLoader) stepper.activateFeedback();
         return window[feedback].call();
      }

      
      active.removeClass('wrong').addClass('done');
      this.openStep(next, callback);
      return this.trigger('nextstep');
   } else {
      return active.removeClass('done').addClass('wrong');
   }

   
};

$.fn.prevStep = function(callback) {
   var active = this.find('.step.active');
   if(active.hasClass('feedbacking')) return;
   var prev = $(this.children('.step:visible')).index($(active));
   active.removeClass('wrong');
   this.openStep(prev, callback);
   return this.trigger('prevstep');
};

$.fn.openStep = function(step, callback) {
  var count_done = document.getElementsByClassName("done").length;
  
  var add_done = this.find('.step.finish');
   var settings = $(this).closest('ul.stepper').data('settings');
   var $this = this;
   var step_num = step - 1;
   step = this.find('.step:visible:eq('+step_num+')');
   if(step.hasClass('active')) return;
   var active = this.find('.step.active');
   var next;
   var prev_active = next = $(this.children('.step:visible')).index($(active));
   var order = step_num > prev_active ? 1 : 0;
   if(active.hasClass('feedbacking')) $this.destroyFeedback();
   active.closeAction(order);
   step.openAction(order, function(){
      if(count_done == 4){
         add_done.addClass('done');
      }
        if(settings.autoFocusInput) step.find('input:enabled:visible:first').focus();
        $this.trigger('stepchange').trigger('step'+(step_num+1));
        if(step.data('event')) $this.trigger(step.data('event'));
        if(callback)callback();
      
   });
};

$.fn.closeAction = function(order, callback) {
   var closable = this.removeClass('active').find('.step-content');
   if(window.innerWidth < 993 || !this.closest('ul').hasClass('horizontal')) {
      closable.stop().slideUp(300,"easeOutQuad", callback);
   } else {
      if(order==1) {
         closable.animate({left: '-100%'},function(){closable.css({display: 'none', left: '0%'}, callback);});
      } else {
         closable.animate({left: '100%'},function(){closable.css({display: 'none', left: '0%'}, callback);});
      }
   }
};

$.fn.openAction = function(order, callback) {
   var openable = this.removeClass('done').addClass('active').find('.step-content');
   if(window.innerWidth < 993 || !this.closest('ul').hasClass('horizontal')) {
      openable.slideDown(300,"easeOutQuad", callback);
   } else {
      if(order==1) {
         openable.css({left: '100%', display: 'block'}).animate({left: '0%'}, callback);
      } else {
         openable.css({left: '-100%', display: 'block'}).animate({left: '0%'}, callback);
      }
   }
};

$.fn.activateStepper = function(options) {
   var settings = $.extend({
      linearStepsNavigation: true,
      autoFocusInput: true,
      showFeedbackLoader: true,
      autoFormCreation: true,
      parallel: false // By default we don't assume the stepper is parallel
   }, options);
   $(document).on('click', function(e){
      if(!$(e.target).parents(".stepper").length){
         $('.stepper.focused').removeClass('focused');
      }
   });

   $(this).each(function(){
      var $stepper = $(this);
      if(!$stepper.parents("form").length && settings.autoFormCreation) {
         var method = $stepper.data('method');
         var action = $stepper.data('action');
         var method = (method ? method : "GET");
         action = (action ? action : "?");
         $stepper.wrap( '<form action="'+action+'" method="'+method+'"></form>' );
      }

      $stepper.data('settings', {linearStepsNavigation: settings.linearStepsNavigation,autoFocusInput: settings.autoFocusInput,showFeedbackLoader:settings.showFeedbackLoader, parallel:$stepper.hasClass('parallel')});
      $stepper.find('li.step.active').openAction(1);
      $stepper.find('>li').removeAttr("data-last");
      $stepper.find('>li.step').last().attr('data-last', 'true');

      $stepper.on("click", '.step:not(.active)', function () {
         var object = $($stepper.children('.step:visible')).index($(this));
         if($stepper.data('settings').parallel && validation) { // Invoke parallel stepper behaviour
            $(this).addClass('temp-active');
            $stepper.validatePreviousSteps()
            $stepper.openStep(object + 1);
            $(this).removeClass('temp-active');
         } else if(!$stepper.hasClass('linear')) {
            $stepper.openStep(object+1);
         } else if(settings.linearStepsNavigation) {
            var active = $stepper.find('.step.active');
            if($($stepper.children('.step:visible')).index($(active))+1 == object) {
               $stepper.nextStep(undefined, true, undefined);
            } else if ($($stepper.children('.step:visible')).index($(active))-1 == object) {
               $stepper.prevStep(undefined);
            }
         }
      }).on("click", '.next-step', function(e) {
         e.preventDefault();
         $stepper.nextStep(undefined, true, e);
      }).on("click", '.previous-step', function(e) {
         e.preventDefault();
         $stepper.prevStep(undefined);
      }).on("click", "button:submit:not(.next-step, .previous-step)", function (e) {
         e.preventDefault();
         feedback = e ? $(e.target).data("feedback") : undefined;
         var form = $stepper.closest('form');
         if(form.isValid()) {
            if(feedback) {
               stepper.activateFeedback();
               return window[feedback].call();
            }
            form.submit();
         }
      }).on("click", function () {
         $('.stepper.focused').removeClass('focused');
         $(this).addClass('focused');
      });
   });
};

/**
 * Return the step element on given index.
 *
 * @param step, index of the step to be returned
 * @returns {*}, the step requested
 */
$.fn.getStep = function(step) {
    var settings = $(this).closest('ul.stepper').data('settings');
    var $this = this;
    var step_num = step - 1;
    step = this.find('.step:visible:eq('+step_num+')');
    return step;
};

/**
 * Run validation over all previous steps from the steps this
 * function is called on.
 */
$.fn.validatePreviousSteps = function() {
    var active = $(this).find('.step.temp-active');
    var index = $(this.children('.step')).index($(active));
    // We assume that the validator is set to ignore nothing.
    $(this.children('.step')).each(function(i) {
        if (i >= index) {
            $(this).removeClass('wrong done');
        } else {
            $(this).validateStep();
        }
    });
};

/**
 * Validate the step that this function is called on.
 */
$.fn.validateStep = function() {
    var stepper = this.closest('ul.stepper');
    var form = this.closest('form');
    var step = $(this);
    // Retrieve the custom validator for that step if exists.
    var validator = step.find('.next-step').data("validator");
    if(this.validateStepInput()) { // If initial base validation succeeded go on
      if(validator) { // If a custom validator is given also call that validator
         if (window[validator].call()) {
             step.removeClass('wrong').addClass('done');
             return true;
         }
         else {
             step.removeClass('done').addClass('wrong');
             return false;
         }
      }
      step.removeClass('wrong').addClass('done');
      return true;
    } else {
      step.removeClass('done').addClass('wrong');
      return false;
    }
};

/**
 * Uses the validation variable set by the stepper constructor
 * to run standard validation on the current step.
 * @returns {boolean}
 */
$.fn.validateStepInput = function() {
    var valid = true;
    if (validation) {
        // Find all input fields dat need validation in current step.
        $(this).find('input.validate').each(function() {
            if (!$(this).valid()) {
                valid = false;
                return false;
            }
        });
    }
    return valid;
};
</script>
<script>
  frappe.csrf_token = "{{ csrf_token }}";
</script>
 

{% endblock %}